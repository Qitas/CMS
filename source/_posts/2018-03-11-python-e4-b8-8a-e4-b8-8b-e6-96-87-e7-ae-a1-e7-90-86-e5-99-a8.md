---
title: python上下文管理器
url: 1143.html
id: 1143
categories:
  - I·TQ
tags:
  - python
---

与装饰器类似，包装代码块，保证一致的进入和退出，一定能保证退出步骤的执行，确保资源正确收回。 通过with语句可以进入上下文管理，常见的如with open()用于打开文件。本质上是with对其后对象求值，而其后对象需要有\_enter\_和\_exit\_方法，通过\_enter\_方法返回结果，结果可以被其后的as接收赋值给后面的变量。 \_enter\_方法不接受self之外的其他参数，对象在其\_enter\_方法返回后执行。\_exit\_方法除了self参数还带有异常类型、异常实例和回溯3个位置参数。 上下文管理器主要用于避免代码重复，确保某种资源以期望的方式初始化和反初始化，确保出现异常时正确关闭资源。上下文块内的已经被处理的异常不会发送给\_exit\_方法。 python标准库提供@contextlibr.contextmanager装饰器，提供类似上下文管理的功能，被装饰的函数执行返回单个值，用于创建最简单的上下文管理。装饰器主要用于封装命名函数和类，上下文适合用于封装任意代码段。