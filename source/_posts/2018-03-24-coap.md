---
title: COAP
url: 1344.html
id: 1344
categories:
  - I·TQ
tags:
  - 协议
  - 通信
---

COAP（Constrained Application Protocol）作为物联网应用中常用的通信协议，协议借鉴了HTTP协议机制并简化了协议包格式，简洁地实现了物联网设备之间通信。

* * *

COAP对云端设备资源操作都是通过请求与响应机制来完成，以消息为数据通信载体，通过交换网络消息来实现设备间数据通信，类似HTTP通过4个请求方法（GET, PUT, POST, DELETE）对服务器端资源进行操作。 COAP是超轻量型协议，基于UDP，而UDP是一种无连接的传输层协议，提供面向事务的简单不可靠信息传送服务，所以需要高层构建协议方向控制。COAP也是6LowPAN协议栈中的应用层协议，协议包轻量级，最小长度仅为4 Byte（Header固定为4byte），COAP的默认UDP端口号为5683。 设备端与云端之间双向通信基于4种消息类型：需要确认消息CON、不需要确认消息NON、确认应答消息ACK和复位消息RST，可以实现2种传输质量：可靠消息传输与不可靠消息传输。 当需要使用COAP协议传输大量数据时需要采用分块传输，把文件拆解成多个块进行传输。扩展的块传输协议在COAP基础协议上增加了3个options， 2个response codes用于块传输大小协商及控制。 COAP使用DTLS来做安全传输层，如果运行设备的性能太弱，资源限制可能无法运行DTLS安全加密算法，可以不加入安全层。 和COAP直接竞争是MQTT，MQTT基于TCP，在做反控设备的时候比UDP更可靠，如COAP走3G、4G网路的时候需要实现CoAP over TCP，否则反控很不稳定甚至无法联通。而MQTT是异步通信设计，通过异步Pub/Sub实现，无需等待对方确认便可以继续，而COAP是同步模式，必须等待对方应答才能返回。而且MQTT为物联网设计的QoS、“遗言”机制非常实用。 一般来说，长连接采用MQTT而无连接采用COAP，COAP在功耗方面略有优势，COAP大体上在WSN内部可以使用，而要连接服务器目前还是MQTT更好，BAT提供的各种物联网的云服务都是基于MQ，目前应用较多的是MQ，MQTT协议是基于订阅与发布模型的，COAP通过扩展协议方式也简单的实现了订阅与发布模型，在LPWAN领域，炙手可热的NB-IoT通常采用CoAP。

* * *