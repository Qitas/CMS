---
title: C语言内存
url: 1380.html
id: 1380
categories:
  - I·TQ
tags:
  - C
  - 编程
---

以前只接触简单的C语言使用，用不到或者是不能使用内存分配，现在随着接触深入和复杂化，需要把缺失的这部分找回来。 在稍微复杂的系统里，只有部分内存能被程序代码直接访问，内存的低位地址空间被操作系统占据，高位地址空间被分为4个部分：代码段、数据段、堆空间和栈空间。 C程序被编译运行，机器码被加载到内存中的代码段，内存的数据段用于保存程序执行周期中使用到的变量，包括全局变量和静态类型的局部变量。内存的数据段又可以分为经初始化的数据段和未经初始化的数据段，后者又被称为BSS。 堆栈的概念在很多语言中都有，也是一个很常见的考点，堆空间只能在运行时通过指针分配给各种变量、字符串和数组，所以堆空间也被称为动态内存，需要使用malloc()、calloc()、realloc()等函数。在C语言中使用动态内存需要主动使用free()等函数释放空间，堆空间靠近BSS区域，并且向高地址扩展，后继元素的地址大于前面的元素。 对于函数内部使用的临时变量，如果没有声明为static类型，这些变量存在于栈空间，元素的顺序LIFO，每一次函数调用会创建一个栈帧（stack frame），用于保存函数的局部变量、临时信息、函数参数和返回地址等数据，函数返回后栈帧被删除。 编译期间分配的内存被成为静态内存，对于静态内存是由编译器负责分配和回收，但是静态内存容量有限，使用不够灵活，难以应付一些不确定的场景，所以需要搭配动态内存。在C语言中通过malloc()函数向堆空间申请分配指定字节数的内存，函数定义在和中，malloc()返回的是一个void类型指针（void类型指针可以转换为任意其他类型指针），传入malloc()的参数为申请内存的字节数。 通过malloc()获得的动态内存空间，可以通过calloc()函数再进行修改，主要修改内存空间的大小，例如str=(char *)malloc(20); 获得20字节的空间，通过str=(char *)realloc(str,25);增长到25字节但是不回清空已有的数据。 当然如果要从堆空间获取多个相同大小的内存块，可以通过calloc(num,size)，返回的和malloc()一样是分配内存空间的首地址指针，但和malloc()函数相比的主要区别在于：calloc()会初始化分配的空间。