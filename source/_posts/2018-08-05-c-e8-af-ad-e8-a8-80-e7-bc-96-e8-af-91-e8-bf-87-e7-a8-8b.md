---
title: C语言编译过程
url: 1545.html
id: 1545
categories:
  - I·TQ
tags:
  - C
  - 编程
---

作为一名嵌入式工程师，并且还在Linux下进行开发的，却很难条理清晰地讲述C语言具体编译过程，大抵只有应用上的概念，缺少条理清晰的理论支撑，就无法证明自己足够优秀。 首先有一个预处理的过程，就是将宏定义的内容和引用的文件整合到一个文件序列中，更直白地说是将#include替换为对应的内容，也包括处理掉#ifdef这些条件编译，处理掉源文件中方便人阅读的其他部分，如注释，是一个编译执行的准备过程，不考虑语法问题。通过预处理将.c文件转换到新的.c文件，或则是.i文件。 然后进行的是编译过程，将C语言编译成机器语言，可以直接是将.c变为.o二进制文件，或则是通过生成中间的.s汇编文件再生成二进制文件（Linux下对应.o文件，window下对应.obj文件）。也有将这步分为两个步骤，前者是从预处理文件到汇编文件叫编译，后者是从汇编文件到目标文件叫汇编 然后进行相关二进制执行文件的链接，将所有相互依赖的文件进行整合，链接分为静态链接和动态链接，前者会把依赖的文件复制整合到执行文件中，后者只进行登记，在使用时再找到相应内容执行。动态链接库（以.so结尾）和静态链接库（以.a结尾），GCC链接优先使用动态链接库，只有当动态链接库不存在时才考虑使用静态链接库，可以在编译时加-static强制使用静态链接库。 在预处理过程中，并不是所有的预处理指令都会被替换，例如#pragma就会保留。 常用的C语言编译器是gcc，对应预处理过程中的指令如 gcc -o hello.i hello.c -E 、gcc -E test.c -o test.i或者是gcc -E test.c ；对应编译过程的指令gcc -S test.i -o test.s；对应的汇编过程gcc -c test.s -o test.o；对应链接过程gcc –L /xxx/lib test.o –o test 或直接 gcc test.o -o test，完整地编译gcc test.c -o test。