---
title: modbus
url: 1744.html
id: 1744
comments: false
categories:
  - I·TQ
tags:
  - 协议
  - 通信
---

Modbus是一个请求/应答协议，应用于控制器相互之间、控制器经由网络和设备间通信,属于嵌入式通信常用应用层协议。Modbus不管消息结构是经过何种网络进行通信的，它描述了一控制器请求访问其它设备的过程，如果回应来自其它设备的请求，以及怎样侦测错误并记录。 ModBus协议是应用层报文传输协议（位于OSI模型第7层），它定义了一个与通信层无关的协议数据单元（PDU=功能码+数据域），ModBus协议能够应用在不同类型的总线或网络，对应不同的总线或网络，Modbus协议引入一些附加域映射成应用数据单元（ADU）。目前Modbus有三种通信方式： 1.以太网，对应MODBUS TCP模式 2.异步串行传输（RS-232-/422/485/光纤/无线等），对应MODBUS RTU模式或MODBUS ASCII模式 3.高速令牌传递网络，对应Modbus PLUS模式(Modicon专有,和Modbus不同),连接Modbus Plus到计算机需要特别的接口,通常是支持ISA,PCI或者PCMCIA总线的板卡 重点介绍串行传输模式： ASCII模式：帧头冒号（‘:’，ASCII码 3AH），以回车+换行符结束（ASCII码 0DH,0AH），其它域使用十六进制的0...9,A...F。处在其网络上的设备不断侦测“:”字符，当有一个冒号接收到时，每个设备都解码下个域（地址域）确认收件人。 RTU模式：消息发送至少要以3.5个字符的停顿时间间隔开始，以一个至少3.5个字符的停顿时间结束，传输的第一个域是设备地址。处在其网络上的设备不断侦测网络总线，包括停顿间隔时间内。当第一个域（地址域）接收到后解码确定收件人。 消息帧的地址域包含两个字符（ASCII模式）或8 Bit（RTU模式），主设备通过将要联络的从设备的地址放入消息中的地址域来选通从设备。当从设备发送回应消息时，它把自己的地址放入回应的地址域中，以便主设备知道是哪一个设备作出回应，地址0是用作广播地址。应答包中，数据包括了数据字节长度+数据值，请求包中数据只包含数据值，“数据数量”字段只有在响应包中才有。 整个消息帧必须作为一连续的流转输，如果在帧完成之前有超过1.5个字符时间的停顿时间，接收设备将刷新不完整的消息并假定下一字节是一个新消息的地址域。同样地，如果一个新消息在小于3.5个字符时间内接着前个消息开始，接收的设备将认为它是前一消息的延续。 modbus协议的数据主要分为四类：离散量输入(Discretes Input，位变量只读)、线圈状态(Coils位变量读写)、输入寄存器(Input Registers字变量只读)、保持寄存器(Holding Registers字变量读写)，其中离散量输入适用功能码02H，线圈状态适用功能码01H 05H 0FH，输入寄存器只读模拟量适用功能码04H，保持寄存器对应可读写模拟量适用功能码03H 04H 06H 0FH。 功能码可以分为位操作和字操作两类。位操作的最小单位为BIT，字操作的最小单位为两个字节。位操作指令读线圈状态01H，读(离散)输入状态02H，写单个线圈06H和写多个线圈0FH。字操作指令读保持寄存器03H，写单个寄存器06H，写多个保持寄存器10H。